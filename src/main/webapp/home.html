<html>
    <head>
        <title>Home</title>
    </head>
    <body>
        <form method="GET" action="/api/tracker" onsubmit="return enroll();">
            <fieldset>
                <label for="raceId">Select race</label>
                <select id="raceId" name="raceId"></select><br/>

                <label for="extUserId">Bib number</label>
                <input id="extUserId" name="extUserId" type="text" 
                       placeholder="9999991678885900001A0996"/><br/>

                <input type="submit" value="Enter Race" />
            </fieldset>
        </form>
        <table>
            <thead>
                <tr>
                    <th>raceId</th><th>fitness actionId</th><th>Edit</th>
                </tr>
            </thead>
            <tbody id="racesBody"></tbody>
        </table>
        <script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
        <script src="/js/crud_api.js"></script>
        <script type="text/javascript">
function loadMyRaces() {
    $("#racesBody").html("");
    crud_Read("api/participant", "me")
    .done(function(data, statusText, jqXHR) {
        $.each(data, function(index, item) {
            $("#racesBody").append("<tr><td>" +
                item.raceId + "</td><td>" + item.actionId + 
                "</td><td><a href='splits.html?raceId=" + item.raceId + 
                "&participantId=" + item.id + "'>" + item.actionId + 
                "</a></td></tr>");
        });
    });
}
    
function enroll() {
    crud_Read("api", "tracker?raceId=" + $("#raceId").val() + 
            "&extUserId=" + $("#extUserId").val())
    .done(function(data, statusText, jqXHR) {
        loadMyRaces();
    });

    return false;
}            
                            $(function() {
                                crud_Read("pub", "course")
                                .done(function(data, statusText, jqXHR) {
                                    $.each(data, function(index, item) {
                                        $("#raceId").append('<option value="' +
                                            item.id + '">' + item.displayName + 
                                            '</option>');
                                    });
                                });
                                
                                loadMyRaces();
                            });
        </script>
    </body>
</html>